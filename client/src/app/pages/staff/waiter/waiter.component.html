<div *ngIf="loading" class="loading-state">
  <p>Đang tải thực đơn...</p>
</div>

<div *ngIf="error" class="error-state">
  <p>{{ error }}</p>
</div>

<div *ngIf="!loading && !error" class="container">

  <!-- PANEL TRÁI: DANH SÁCH MÓN -->
  <div class="menu-panel">
    <h2>Thực Đơn</h2>
    <div class="product-grid">
      <div class="card" *ngFor="let p of products" (click)="selectProduct(p)">
        <img [src]="p.urlImage" [alt]="p.nameProduct" (error)="onImgError($event)">
        <h3>{{ p.nameProduct }}</h3>
        <p class="price">{{ p.price | number:'1.0-0' }} ₫</p>
        <span [class.active]="p.status" [class.inactive]="!p.status">
          {{ p.status ? 'Còn bán' : 'Hết hàng' }}
        </span>
      </div>
    </div>
  </div>

  <!-- PANEL PHẢI: GIỎ HÀNG -->
  <div class="details-panel">
    <h2>Chi Tiết Giỏ Hàng</h2>

    <div *ngIf="cart.length; else emptyCart">
      <div class="cart-list">
        <div class="cart-item" *ngFor="let item of cart">
          <img [src]="item.product.urlImage" (error)="onImgError($event)">
          <div class="info">
            <h4>{{ item.product.nameProduct }}</h4>
            <p>{{ item.product.price | number:'1.0-0' }} ₫</p>
            <div class="quantity">
              <button (click)="decreaseQuantity(item)">-</button>
              <span>{{ item.quantity }}</span>
              <button (click)="increaseQuantity(item)">+</button>
            </div>
          </div>
        </div>
      </div>

      <div class="table-selection">
        <h3>Chọn bàn</h3>
        <div class="table-grid">
          <div
            *ngFor="let t of tables"
            class="table-box"
            [ngClass]="{ 'selected': tableStatus[t] }"
            (click)="selectTable(t)"
          >
            Bàn {{ t }}
          </div>
        </div>


      </div>


      <div class="cart-summary">
        <div class="summary-row">
          <p><strong>Tổng số món:</strong> {{ totalItems }}</p>
          <p><strong>Tổng tiền:</strong> {{ totalPrice | number:'1.0-0' }} ₫</p>
        </div>

        <div class="bottom-row">
    <textarea
      id="note"
      [(ngModel)]="note"
      placeholder="Ghi chú (VD: Không đá, ít đường...)"
      rows="2"
    ></textarea>

          <button class="submit-btn" (click)="submitOrder()">Xác nhận đặt</button>
        </div>
      </div>


    </div>

    <ng-template #emptyCart>
      <p class="placeholder-text">Chưa có món nào được chọn.</p>
    </ng-template>
  </div>
</div>
